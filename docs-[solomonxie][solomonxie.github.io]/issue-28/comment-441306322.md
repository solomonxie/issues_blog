# MongoDB 高级查询

### 比较运算符
- `:` 等于
- `$lt`: Less Than
- `$gt`: Greater Than
- `$gte`: Greater Than or Equal
- `$ne`: Not Equal

```sql
# age大于等于18
db.mycollection1.find( { age:{$gt: 18} } )
```

#### 逻辑运算符
- `$and`
- `$or`

```sql
db.mycollection1.find( {
    $or: [
        { age: {$gte: 20} },
        { salary: {$gt: 5000} },
        { job: "HR" }
    ]
} )
```

### 范围运算符
- `$in`
- `$nin`: Not In

```sql
db.mycollection1.find( {
    age: {
        $in: [10, 20, 30]
    }
} )
```

### 正则表达式
有两种方法：
- `/表达式内容/`
- `{$regex: "表达式内容"}`

```sql
db.mycollection1.find( {
    name: /^Ja\w+$/
} )

# 或
db.mycollection1.find( {
    name: {
        $regex: "/^Jaso\w?$"
    }
} )
```


### limit和skip

```sql
# 限定显示条数
db.mycollection1.find().limit(数量)

# 跳过指定第几条数据
db.mycollection1.find().skip(2)

# 混合使用
db.mycollection1.find().limit(10).skip(3)
```


### 自定义函数查询
自定义查询是指使用自定义函数，格式为`$where: function(){...}`

```sql
db.mycollection1.find( {
    $where: function() {
        return this.age >= 18;
    }
} )
```


### 投影

即搜索的返回值中，只显示指定的某些字段。字段指为0的不现实，指为1的显示，默认为1。

```sql
# 格式为：
db.mycollection1.find(
    {查询条件},
    {显示与否的选项}
)

# 如:
db.mycollection1.find(
    {},
    { _id: 0, name: 1, age: 1 }
)
```


### 排序

可以按指定的某些字段排序，字段标记为1的为Asc升序，标记为-1的为Desc降序。

```sql
db.mycollection1.find().sort({  name:1, age:-1 })
```


### 统计

使用count()函数。

```sql
db.mycollection1.find().count()

db.mycollection1.count( {查询条件} )
```

### 消除重复

使用distinct()函数。

```sql
# 格式为：
db.集合名.distinct( "指定字段", {查询条件} )

# 如
db.mycollection1.distinct( 
    "job", 
    { age: {$lt: 40} } 
)
```
