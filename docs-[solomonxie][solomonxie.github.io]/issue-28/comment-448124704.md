# SQLAlchemy的进阶小操作


## 根据表名获取对应的ORM类引用

```py
def get_class_by_tablename(tablename):
    for cls in Base._decl_class_registry.values():
        if hasattr(cls, '__table__') and cls.__table__.fullname == tablename:
            return cls

print( get_class_by_tablename('tb_Tracks') )
```


## 检验是否已存在数据再插入

[参考：SQLAlchemy commit(), flush(), expire(), refresh(), merge() - what's the difference?](https://www.michaelcho.me/article/sqlalchemy-commit-flush-expire-refresh-merge-whats-the-difference)

以下方法先称为`session.merge()方法`, 它能极快的完成插入之前的数据是否重复的检验：
```py
user1 = User.query.get(1)
user1.name  # ==> 'user1'

new_user = User(user_id=1)  # ==> a second in-memory object with the same key!
new_user.name = 'user2'
user1.name  # ==> 'user1'. Without merging, user1 doesn't know it is the same as new_user

db.session.merge(new_user)
user1.name  # ==> 'user2'. Now updated in memory. Note not yet updated in db, needs flush() and commit()
```