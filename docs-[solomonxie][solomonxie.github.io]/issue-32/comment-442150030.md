# Django 基础


## MVC／MVT 框架

> **`MVC`是一种编写代码的逻辑上的分割模型，即把代码分为三大部分：M、V、C，每部分明确的负责一个层面。这样的作用是什么？那就是为了日后更方便的代码维护、代码迁移和代码重构等。**

[参考Wiki：Model–view–controller](https://www.wikiwand.com/en/Model%E2%80%93view%E2%80%93controller)

传统的MVC（Model-View-Control)模型适用于大多数的桌面App和网络App的程序编写。
即`Model模型`(负责数据库) -> `View视图`(负责将数据显示为最终界面) -> `Controller控制器`(负责将用户请求转化为界面或数据库的改动)。

~这里面的`View`和`Controller`有点“反认知"，因为这里的view不代表“显示界面”，而是代表“流程／路由”，即把客户对不同网址的请求转发到不同的处理函数上。相反的，Controller控制器却是负责“最终显示”的层面。~

![image](https://user-images.githubusercontent.com/14041622/49124607-0a18aa80-f2f8-11e8-80c8-fe8070fc00e4.png)


Django的代码结构是典型的MVC框架。只是具体实施上，它用Template模版来实现Controller控制器，所以也叫MVT模型。Django中，实际上的顺序是MTV，即`Model -> Template -> View -> user`。也就是说，~Model从数据库取出数据，Template把数据动态渲染为。。。。~

Template不应该是负责显示吗，怎么变成了Controller呢？
在Django网络App模型中，用户请求一个网页的View，这时Template负责根据不同的url网址，动态地渲染出一个HTML返给View来显示。所以Template实际上就成了Route路由和Controller的身份。

了解Django的这种“代码结构”有什么作用？
因为Django是一个以及成熟开发的网络App，我们要做的只是改一改具体业务信息即可。正因为他是已经完整开发的App，所以我们要清楚他开发的结构是什么，**才知道哪种需求到哪里去改。**




## ORM模型

`Object-Relations-Mappings`，实际上是`Object -> Mappings -> Relations`这种方向，
**即把业务抽象为程序中的`Object对象`，然后通过一种`Mappings方法`，映射为`Relational数据库`的表格中去。**




## 安装

建议在虚拟环境中，且为django项目独立创建：
```sh
$ pip install django
```

## 创建Django项目

```sh
$ django-admin startproject ./MyDjangoProject
```

创建好Django项目后，文件夹中会出现如下目录结构：
- `./MyDjangoProject`
    - `manage.py`：整个项目的管理文件
    - `MyDjangoProject`：整个项目文件
        - `__init__.py`
        - `setting.py`：项目配置文件
        - `urls.py`：网址的路由设置，不同路径分配不同的处理函数
        - `wsgi.py`：作为Web Server，并负责和Django框架进行交互


![image](https://user-images.githubusercontent.com/14041622/49100465-fd239900-f2ae-11e8-943b-b8c12de9f860.png)

涉及好`业务模块`后，在Django中，我们将模块分开：一个模块配一个Django的`app`应用。

在一个Django项目中，创建一个子app应用的命令为：
```sh
$ python ./manage.py startapp MyApp01
```
创建好子app的MyApp01后，Django的目录中就出现了一个子目录`MyApp01`，结构如下：
- `./MyApp01`
    - `admin.py`：网址后台Dashboard相关
    - `__init__.py`：
    - `migrations/`
        - `__init__.py`
    - `models.py`：MVC中的M，负责和数据库交互
    - `tests.py`：测试代码
    - `views.py`：MVC中的V，负责页面的模版


**建立好各个子模块后，我们需要在项目主配置`settings.py`中把每个子模块进行注册，才能集合为一个项目。**

在`settings.py`中注册的方法如下：

![image](https://user-images.githubusercontent.com/14041622/49101464-3957f900-f2b1-11e8-86bc-56db39426a36.png)


启动服务器：
```py
$ python ./manage.py runserver IP:端口
```

然后就会启动一个指定IP的服务器：

![image](https://user-images.githubusercontent.com/14041622/49101587-85a33900-f2b1-11e8-9e11-917f716f3ad5.png)
