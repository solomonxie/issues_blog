# Bash脚本判别使用者的身份

经常要在bash脚本里面或者直接对脚本本身加上`sudo`运行命令，但是这引发了一系列的问题。

比如用sudo的时候，脚本里的`~`或`$HOME`指代用户文件夹的这个变量，到底是应该指向我真正的用户文件夹如`/home/pi`呢，还是指向了超级管理员的用户文件夹`/root/`呢？

实际上它指向了`/root/`文件夹，这是我们绝对不想要的。但是很多命令如安装个程序，都不得不用`sudo`，那怎么办？

为了能检测出正确的用户和用户路径，我写了以下脚本，并分别用普通用户`pi`执行和用sudo执行：
```sh
# 简单说明当前的权限者是谁（不推荐！）
$ whoami
(root)>>> root
(pi) >>> pi

# 不同于whoami，能够指出当前有哪些用户登录电脑，包括本机登录和ssh登录的所有人
$ who am i
(root)>>> pi       tty1         2018-11-25 04:18
(pi) >>> pi       tty1         2018-11-25 04:18

# 等同于whoami （不推荐！）
$ echo $USER
(root)>>> root
(pi) >>> pi

$ echo $LOGNAME
(root)>>> pi
(pi) >>> pi

# SUDO_USER是ENV中的环境变量，但是直接打印$SUDO_USER是空的，要用比如~user格式
$ echo ~$SUDO_USER
(root)>>> /home/pi
(pi) >>> /home/pi

# 用户主目录位置 (不靠谱不推荐！）
echo $HOME
(root)>>> /root
(pi) >>> /home/pi

$ 用户主目录位置，等同于$HOME （不推荐！）
$ echo ~
(root)>>> /root
(pi) >>> /home/pi
```

从上面测试中可以看出，如果我们是用sudo执行bash脚本的话，很多变量都是“不靠谱”的。
Stackoverflow中，比较一致性的倾向就是使用`$SUDO_USER`这个环境变量。直接echo打印不出来，需要用`~<用户名>`这样的格式才能显示出来。

