# 利用Haproxy实现Shadowsocks负载均衡

- 在家里树莓派上安装Haproxy作为前端入口，然后把流量分发给各个后端SS主机



## 树莓派本地Shadowsocks-client客户端安装与配置



## Haproxy安装与配置

参考：https://tianws.github.io/skill/2019/07/11/gfw/

```sh
$ sudo apt install haproxy -y
$ sudo mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak # 备份
$ sudo vim /etc/haproxy/haproxy.cfg # 编辑配置文件
```

配置文件设置：
```ini
global
    log /dev/log local0
    log /dev/log local1 notice
    user root
    group root
    daemon

defaults
    log global
    mode tcp
    timeout connect 5s
    timeout client 5s
    timeout server 5s
    option      dontlognull
    option      redispatch
    retries     3

listen status
  bind *:1111
  mode  http
  stats refresh 30s
  stats uri /status
  stats realm Haproxy  
  stats auth admin:admin
  stats hide-version
  stats admin if TRUE

frontend shadowsocks-in
    mode tcp
    bind *:8388
    default_backend shadowsocks-out

backend shadowsocks-out
    mode tcp
    option      tcp-check
    balance roundrobin
    server  servername1    xxxxx1.com:8088  check
    server  servername2    xxxxx2.net:8080  check
    server  servername3    12.34.56.78:9999  check
    server  servername4    123.234.234.123:443  check
```

使用Haproxy:
```sh
sudo service haproxy start|stop|status|reload|restart|force-reload # 控制 haproxy 的运行
```