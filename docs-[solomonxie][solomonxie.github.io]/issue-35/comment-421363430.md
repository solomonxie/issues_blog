# rsync 强大的远程、本地文件夹同步工具
> 主要将「目录与目录」的同步，个体文件上传下载的就不需要这个程序了。

一般Mac、Ubuntu等主流*nix系统，都原生搭配了这个命令，非常好用。但是命令比较复杂，需要学习。

[参考：rsync参数详解、利用ssh、rsync 实现数据的定时同步](http://blog.51cto.com/colderboy/132054)

注意事项：
- 目录名后有或没有`/`是很不同的，非常复杂。具体参考：[cp拷贝文件夹时`/`的用法](https://github.com/solomonxie/solomonxie.github.io/issues/27#issuecomment-421560989)
- 不是所有参数都能搭配在一起用的，经常会互相冲突，所以要记住常用搭配方式。

参数：
```
-v, --verbose  详细模式输出；
-r, --recursive 对子目录以递归模式处理;
-u, --update  仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件；
--delete 删除那些target中有而source没有的文件;
-a, --archive  归档模式，表示以递归的方式传输文件，并保持所有文件属性不变，相当于使用了组合参数-rlptgoD;
-z, --compress 对备份的文件在传输时进行压缩处理
-S, --sparse 对稀疏文件进行特殊处理以节省target的 空间;
-l, --links 保留软链结;
-H, --hard-links 保留硬链结;
-p, --perms 保持文件权限;
-t, --times 保持文件时间信息;
-g, --group 保持文件属组信息;
-o, --owner 保持文件属主信息;
-D, --devices 保持设备文件信息;
```

## 本地同步
以下为常用的同步语句：
```sh
# 单方向拷贝，同cp命令
$ rsync -r <source>  <target>

# 单方向同步 --recursive --delete 注意这两个是固定搭配
# 如果source中没有的，target目录中有的会被删除
$ rsync -r --delete <source>  <target>
```


## 远程同步 （SSH连接）
> 远程目录的格式都为`<user@remote:path>`，如`pi@192.168.1.2:/home/pi`。以下都以`<remote>`代替。

单方向拷贝：本地->远程
```sh
$ rsync -r <local> <remote>

# 如
$ rsync -r  ~/source/  pi@192.168.1.123:~/target
```

单方向拷贝：远程->本地
```sh
$ rcyn -r <remote> <local>

# 如
$ rsync -r pi@192.168.1.123:/home/pi/remote  ~/local/
```


## 远程同步（SSH连接）
> 无论方向如何，操作和效果是一摸一样的。


把本地文件夹local中的内容拷贝到远程的remote文件夹中：
（传输所有本地有的文件-r，保留时间戳等所有信息-a，删除remote中和本地不同的-u --delete）
```sh
$ rsync -rau --delete <local>/ <remote>
```