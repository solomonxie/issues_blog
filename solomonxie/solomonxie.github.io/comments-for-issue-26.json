[{"url":"https://api.github.com/repos/solomonxie/solomonxie.github.io/issues/comments/368406922","html_url":"https://github.com/solomonxie/solomonxie.github.io/issues/26#issuecomment-368406922","issue_url":"https://api.github.com/repos/solomonxie/solomonxie.github.io/issues/26","id":368406922,"user":{"login":"solomonxie","id":14041622,"avatar_url":"https://avatars2.githubusercontent.com/u/14041622?v=4","gravatar_id":"","url":"https://api.github.com/users/solomonxie","html_url":"https://github.com/solomonxie","followers_url":"https://api.github.com/users/solomonxie/followers","following_url":"https://api.github.com/users/solomonxie/following{/other_user}","gists_url":"https://api.github.com/users/solomonxie/gists{/gist_id}","starred_url":"https://api.github.com/users/solomonxie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/solomonxie/subscriptions","organizations_url":"https://api.github.com/users/solomonxie/orgs","repos_url":"https://api.github.com/users/solomonxie/repos","events_url":"https://api.github.com/users/solomonxie/events{/privacy}","received_events_url":"https://api.github.com/users/solomonxie/received_events","type":"User","site_admin":false},"created_at":"2018-02-26T06:54:11Z","updated_at":"2018-02-26T07:15:43Z","author_association":"OWNER","body":"# 利用`frp`实现树莓派的公网映射（让外网访问本地局域网里的树莓派）\r\n> 一直就想试试把本地电脑公开到公网实现自己做服务器的感觉，有了树莓派后更有这种想法。于是就动手试试。\r\n\r\n听说目前两种方法比较流行：`ngrok`和`frp`。但是`ngrok`是收费的且复杂，`frp`则完全开源免费且简单易用，所以这里来尝试下。\r\n\r\n大概思路就是：自己先有一台公网的服务器（我是在AWS或DigitalOcean租的），然后让本地的树莓派与公网服务器通过`frp`程序达成一种映射连接，这样别人访问公网服务器ip的某个端口时，就会自动转向来访问本地的树莓派了。\r\n\r\n做法是：分别在服务器和本地树莓派上下载frp程序，当然要根据两者自己的系统平台下载不同版本。然后在服务器运行`frps`，即frp-server，在本地运行`frpc`，即frp-client。并且在配置文件里约定好，服务器的哪个端口映射到本地的哪个端口。双方都运行后，就可以正常通过外网访问了。\r\n\r\n[参考文章。](https://mritd.me/2017/01/21/use-frp-for-internal-network-wear/)\r\n[官方下载地址](https://github.com/fatedier/frp/releases)。其中，服务器如果是Ubuntu或Debian系的，就选择`linux_amd64.tar.gz`和`linux_386.tar.gz`结尾的，一个是64位一个是32位。本地树莓派如果是树莓派系统，则选择`linux_arm.tar.gz`结尾的。\r\n\r\n## 第一步服务器上安装`frp`\r\n1. 随便找个目录，下载frp：`wget https://github.com/fatedier/frp/releases/download/v0.16.0/frp_0.16.0_linux_amd64.tar.gz`\r\n2. 解压：`tar -xzvf frp_0.16.0_linux_amd64.tar.gz`\r\n3. 进入目录：`cd frp_0.16.0_linux_amd64`\r\n4. 修改服务器端配置文件：`vim frps.ini`，将内容全部替换为如下：\r\n```ini\r\n# 通用配置段\r\n[common]\r\n# frp 监听地址    (******这里不用改******)\r\nbind_addr = 0.0.0.0\r\nbind_port = 7000\r\n\r\n# 如果需要代理 web(http) 服务，则开启此端口\r\nvhost_http_port = 4080\r\nvhost_https_port = 4443\r\n\r\n# frp 控制面板    (******这里一般不用改，等下测试时访问这个端口就能看到后台管理网页了******)\r\ndashboard_port = 7500\r\ndashboard_user = admin\r\ndashboard_pwd = admin\r\n\r\n# 默认日志输出位置(这里输出到标准输出)\r\nlog_file = /dev/stdout\r\n# 日志级别，支持: debug, info, warn, error\r\nlog_level = info\r\nlog_max_days = 3\r\n\r\n# 是否开启特权模式(特权模式下，客户端更改配置无需更新服务端)\r\nprivilege_mode = true\r\n# 授权 token 建议随机生成       (******这里要记住随机码 等下在本地上还要用******)\r\nprivilege_token = HE7qTtW8Lg83UDKY\r\n# 特权模式下允许分配的端口(避免端口滥用)\r\nprivilege_allow_ports = 4000-50000\r\n\r\n# 心跳检测超时\r\n# heartbeat_timeout = 30\r\n\r\n# 后端连接池最大连接数量\r\nmax_pool_count = 100\r\n\r\n# 口令超时时间\r\nauthentication_timeout = 900\r\n\r\n# 子域名(特权模式需下将 *.domain.com 解析到公网服务器)      (******这里可以先不启用******)\r\n#subdomain_host = domain.com\r\n\r\n# 开启 ssh 穿透(可通过外网链接内网 ssh)      (******这里也要记住密钥等下本地要配置******)\r\n[ssh]\r\ntype = tcp\r\nauth_token = M4P2xsH6RuUkbP9d\r\nbind_addr = 0.0.0.0\r\nlisten_port = 6000\r\n\r\n# 开启 dns 查询穿透(个人用不上)\r\n#[dns]\r\n#type = udp\r\n#auth_token = M4P2xsH6RuUkbP9d\r\n#bind_addr = 0.0.0.0\r\n#listen_port = 5353\r\n```\r\n保存退出后，就可以在当前目录通过`sudo ./frps -c frps.ini`启动服务器端的这项服务了。\r\n测试：\r\n随便找个浏览器，输入服务器的IP和刚刚设置的后台管理端口号，就可以访问了。比如我的服务器IP是13.250.64.172，那么就输入：`http://13.250.64.172:7500`\r\n然后就可以看到如下:\r\n![image](https://user-images.githubusercontent.com/14041622/36657511-e18570da-1b07-11e8-94a1-bb5c2dbdbc28.png)\r\n"}]