# Vim成长之路
## 学vim的笔记。觉得这样历程型的笔记再好不过了。





## 配置：先从配置行号开始
> 其实对初学者来说，不需要太花哨的东西，只需要练习各种快捷键就好了。
但是没有行号是真的很头疼的，所以这是我第一步想做的。

可以直接在vim中输入命令达到效果：
`:set number`
但是这个不会保存，一退出就没有了。所以需要一个配置文件来长期维持。
这个文件就是vim最重要的配置文件了 `.vimrc`，一切的配置语句都写在这个文件里。
它的位置为_~/.vimrc_。
然后这么操作就够了：
```bash
touch ~/.vimrc
vim ~/.vimrc
```
然后在文件里随便找个空位置写上_set number_就ok了。





## 配置：设置颜色主题 
> 既然都开启了`vimrc`技能，就忍不住好奇心去看看还有什么能配置的。这里就不一一说明了，这个坑太大，配置方案太多。先讲个代表性的配色问题。以下在mac下有效。

首先, vim自带有一些基本的色彩主题，一般在`/usr/share/vim/vim74/colors/`中，如下图：
![Default Colors](https://user-images.githubusercontent.com/14041622/35219551-0c24371a-ffae-11e7-93dc-f1e59660b158.png)
这个文件夹由于权限原因，不能动。所以要到当前用户的用户文件夹来增加配置文件。一般当前用户是没有这个配置文件夹的，需要自己新建。
```shell
mkdir ~/.vim 
mkdir ~/.vim/colors
```
然后把下载好的色彩主题包中`/colors/`文件夹全部拷贝到`~/.vim/colors/`中就可以使用了。具体操作如下：
### 下载主题包
这个网址是vim官方收集的各种主题包：[Vim.org色彩主题集](http://www.vim.org/scripts/script_search_results.php?keywords=&script_type=color+scheme&order_by=creation_date&direction=descending&search=search)。
我这里下载了一个badwolf主题，是zip文件。解压后将主题包里`colors`文件夹内的`.vim`文件直接拷贝到`~/.vim/colors/`中即可。
然后在vim或`.vimrc`文件中输入这两句句话配置就成功了：
```vimrc
colorscheme 色彩主题名称
syntax on
```
效果如下图：
![image](https://user-images.githubusercontent.com/14041622/35219872-3d0bac90-ffaf-11e7-94a7-fe6e1531b692.png)






## Vim学习成长列表
> 参考 [Vim简明教程](http://blog.csdn.net/niushuai666/article/details/7275406)

- [x] 各种插入模式
a → 在光标后插入
o → 在当前行后插入一个新行
O → 在当前行前插入一个新行
cw → 替换从光标所在位置后到一个单词结尾的字符

- [x] 简单的移动光标
0 → 数字零，到行头
^ → 到本行第一个不是blank字符的位置（所谓blank字符就是空格，tab，换行，回车等）
$ → 到本行行尾
g_ → 到本行最后一个不是blank字符的位置。
/pattern → 搜索 pattern 的字符串（陈皓注：如果搜索出多个匹配，可按n键到下一个）

- [x] 翻页
Ctrl+f和Ctrl+b  上下翻页
Ctrl+u和Ctrl+d 上下翻半页

- [x] 拷贝/粘贴
 （p/P都可以，p是表示在当前位置之后，P表示在当前位置之前）
P → 粘贴
yy → 拷贝当前行当行于 ddP

- [x] Undo/Redo
u → undo
<C-r> → redo

- [ ] 打开/保存/退出/改变文件(Buffer)
:e <path/to/file> → 打开一个文件
:w → 存盘
:saveas <path/to/file> → 另存为 <path/to/file>
:x， ZZ 或 :wq → 保存并退出 (:x 表示仅在需要时保存，ZZ不需要输入冒号并回车)
:q! → 退出不保存 :qa! 强行退出所有的正在编辑的文件，就算别的文件有更改。
:bn 和 :bp → 你可以同时打开很多文件，使用这两个命令来切换下一个或上一个文件。

- [ ] 重复命令
. → (小数点) 可以重复上一次的命令
N<command> → 重复某个命令N次
2dd → 删除2行
3p → 粘贴文本3次
100idesu [ESC] → 会写下 100个`desu`
`.` → 重复上一个命令—— 100 “desu “.
`3.` → 重复 3 次 “desu”

- [x] 合并行
J 合并当前行和下一行
3J 连同当前行一共合并3行
- [x] 行目跳转
NG → 到第 N 行 
gg → 到第一行
G → 到最后一行。
按单词移动：
w → 到下一个单词的开头。
e → 到下一个单词的结尾。

- [ ] 窗口跳转
Ctrl + w, 然后用JKHL方向键跳转
Ctrl + w 再按q, 退出当前窗口
:sp 将当前窗口分成两个







## Vim 安装插件管理器
安装插件前，一般都会用到`Vundle`这个插件包管理器。它的名字其实是`Vim bundle`的组合。
安装方法可以参考[官网](https://github.com/VundleVim/Vundle.vim)，说的很详细。简单说的话，安装方法如下：
```
git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
```
然后打开`~/.vimrc`，把下面这段话全部粘贴到文件顶部:
```
" Vundle phrases must be on the top
set nocompatible              " be iMproved, required
filetype off                  " required
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()
    Plugin 'VundleVim/Vundle.vim'
call vundle#end()            " required
filetype plugin indent on    " required
```
其中`Plugin`的部分，可以删除不需要的插件。
保存后，直接在Vim界面里输入这个命令：`:PluginInstall`，或在外部运行`vim -c VundleUpdate -c quitall`。然后vim就会跳转到插件安装界面，并自动下载安装上面列出来的插件。
![image](https://user-images.githubusercontent.com/14041622/35513252-6192f5e4-053d-11e8-9c4d-f70aab0b8b54.png)
等到最下面显示`Done!`时，就安装完成了。需要整个退出Vim，再进入，就可以使用了。

## 删除插件
直接在`.vimrc`里把Plugin的那一行删除，然后在vim里运行`:PluginUpdate`即可，然后将`~/.vim/bundle/`下该插件的目录删除。





## Vim上的Snippets插件
> 想要Vim像Sublime一样快速编程，就需要各种好的snippets快速生成一段预备好的代码。一般常用的插件是`UltiSnips`作为生成代码的引擎，`Vim-snippets`插件作为各种语言的常用语句包。

### 安装Snippets插件
在已有Vundle插件管理器的基础上，直接在`.vimrc`文件中加入这两个插件名：
![image](https://user-images.githubusercontent.com/14041622/35559228-243d437c-05e5-11e8-9c9f-4993bdd80282.png)
然后退出vim再进入vim，输入命令: `:PluginInstall`，等待安装完成后，重新进入vim，就可以正常使用了。

### 创建snippets
相比于sublime， 在vim中创建snippets是稍微麻烦点。主要跟随这几点：
- 找到插件目录，是位于`~/.vim/bundle/`下的`ultisnips`和`vim-snippets`。
- 不要在`vim-snippets`中预备好的各语言snippets上直接修改，因为每次更新都会被覆盖。
- 必须在`ultisnips`文件夹下创建一个`UltiSnips`文件夹，所有自定义代码都存在这里。
- 自定义的代码片段必须给每个语言创建单独文件，保存的文件名必须遵循`语言名.snippets`格式.如果是运用到所有文件上的，就叫`all.snippets`。
- 文件保存后即刻生效，无需重启vim。
- 代码片段文件里面需要遵循如下格式：
```
snippet  关键词 “描述” 生成模式
代码片段
endsnippet
```
其中，生成模式有很多种，一般为`b`，即只有在一行的开头输入关键词时，才会调用代码片段。其它还有b, A, w, i等模式，具体可以在vim 的`:help ultisnip`中查看文档。

举个例子，我们要为html文件做一些快捷代码，那么：
```shell
$ vim ~/.vim/bundle/ultisnips/UltiSnips/html.snippets

snippet html "create html 5 structure" b
<!DOCTYPE html>
<html>
<head><title></title></head>
<body>
</body>
</html>
endsnippet
```
保存后打开一个html文件，找个地方输入`html`然后按Tab，就会弹出预定好的html代码。
注意：由于安装了`vim-snippets`常用代码集，html文件中的很多关键词都被占用了，比如`html`。所以要避免冲突，可以直接到`~/.vim/bundle/vim-snippets/UltiSnips`中对应的文件中查看：
![image](https://user-images.githubusercontent.com/14041622/35560217-b50bba1c-05e7-11e8-8595-3109f8e68a48.png)


### snippets 高阶用法
> 上面只是输入关键词然后生成一段固定内容的方法。实际上更常用的方法是，根据给定的变量生成动态内容，或是指定需要更改的几个位置，生成内容后自动把焦点分别指向这几个位置供你修改。





## 从源代码编译Vim 8.0 （当前环境：树莓派原生系统）
> 因为在安装某个vim最难安装的插件，必须要最新版本的vim才行，而通过`apt-get`是无法更新vim的，所以又必须要自己在本地编译源代码才行。所以才花了几个小时倒腾这个。我相信，非常非常非常多的人在编译vim都遇到了困难。

因为不敢在Mac自己机子上随便试，就拿树莓派练手。安装过程不光麻烦，而且耗时比较长。具体是参考[这篇文档](https://github.com/Valloric/YouCompleteMe/wiki/Building-Vim-from-source)安装，中文翻译版本在[这里](https://linux.cn/article-8094-1.html)。
简而化之，我使用的命令如下：
```shell
# 安装基础支持库
sudo apt install libncurses5-dev libgnome2-dev libgnomeui-dev \
    libgtk2.0-dev libatk1.0-dev libbonoboui2-dev \
    libcairo2-dev libx11-dev libxpm-dev libxt-dev python-dev \
    python3-dev ruby-dev lua5.1 lua5.1-dev libperl-dev git

# 删除已安装的vim和所有相关
sudo apt-get remove vim vim-runtime gvim vim-tiny vim-common vim-gui-common vim-nox

# 从vim的github上下载最新的源文件（太慢的话就直接手动去其github页面下载zip文件并解压）
cd ~
git clone https://github.com/vim/vim.git

# 初始化配置
cd vim
./configure --with-features=huge \
    --enable-multibyte \
    --enable-rubyinterp=yes \
    --enable-pythoninterp=yes \
    --with-python-config-dir=/usr/lib/python2.7/config \
    --enable-python3interp=yes \
    --with-python3-config-dir=/usr/lib/python3.5/config \
    --enable-perlinterp=yes \
    --enable-luainterp=yes \
    --enable-gui=gtk2 --enable-cscope --prefix=/usr
make VIMRUNTIMEDIR=/usr/share/vim/vim80

# 编译
cd ~/vim
sudo make install

# 设置vim为默认编辑器
sudo update-alternatives --install /usr/bin/editor editor /usr/bin/vim 1
sudo update-alternatives --set editor /usr/bin/vim
sudo update-alternatives --install /usr/bin/vi vi /usr/bin/vim 1
sudo update-alternatives --set vi /usr/bin/vim

# 检查vim版本
vim --version
```





## Vim自带补全工具 OmniComplete
用了一天倒腾自动补全插件，实在是崩溃，但凡有点名气的都对vim本身的编译有很麻烦的要求。搜索过程中才发现Vim其实是自带补全功能的，称为`OmniComplete`。
输代码的过程中，直接按`Ctrl+X`然后再按`Ctrl+O`，就会弹出vim猜测的一系列补全内容。可以在菜单里按“上下键”选择，注意是方向上下键，不是JK键。
经过测试，原生支持很多种语言。
![image](https://user-images.githubusercontent.com/14041622/35573497-42d7e634-0612-11e8-80de-75c35583f096.png)






## Vim键盘映射
> 之前一直在找方法将`Capslock`键映射为`Esc`键，这样vim中就不用每次跑很远去按Esc了。可惜MacOS最新版的系统都无法很好兼容市面上的键盘映射软件，就放弃了。
然后发现Vim其实本身就可以设置键盘映射，这样大好，原本对Key Mapping需求多的也只有Vim而已，其它地方不太需要这么乱七八糟的改键。

### 方法一：直接在Vim中输入命令
`:map 原键 新键`
如`:map a b`，就是按a时会变成b。`:map <Esc> <C-c>`则是把`Esc`映射为`Ctrl+C`。
输入映射命令时需要注意大小写。
另外：
这个命令不是临时的，退出vim后依然存在。如果需要删除，则用`:mapclear`命令清楚所有的。

### 方法二：在`.vimrc`中配置






## <Leader>是什么东西
参考[这篇](http://learnvimscriptthehardway.stevelosh.com/chapters/06.html)。
![image](https://user-images.githubusercontent.com/14041622/35732048-f7aa915a-0852-11e8-886b-6465a5ac1973.png)
说白了，就是一个快捷命令的前缀。一般比如cc，dd之类都被占用，映射起来不方便。所以加上`前缀`后，就可以追加各种自己喜欢的快捷命令了。
Vim的默认Leader前缀是`\`键。





## Vim注释的方法
> Vim里面注释对初学者真是比较头疼的事情。需要先$跳到行头，i插入模式，输入注释，Esc退出插入模式。如果批量就更麻烦。下面是几种常用方法。

1. 原生方法一
> `Ctrl+v`进入Block选择，向下移动选择待注释行，`Shift+i`批量插入，输入注释符，按两次Esc退出，等几秒实现批量注释。

2. `.vimrc`配置文件法
在`.vimrc`中加入如下语句：
```
" Commenting blocks of code.
autocmd FileType c,cpp,java,scala let b:comment_leader = '// '
autocmd FileType sh,ruby,python   let b:comment_leader = '# '
autocmd FileType conf,fstab       let b:comment_leader = '# '
autocmd FileType tex              let b:comment_leader = '% '
autocmd FileType mail             let b:comment_leader = '> '
autocmd FileType vim              let b:comment_leader = '" '
noremap <silent> ,cc :<C-B>silent <C-E>s/^/<C-R>=escape(b:comment_leader,'\/')<CR>/<CR>:nohlsearch<CR>
noremap <silent> ,cu :<C-B>silent <C-E>s/^\V<C-R>=escape(b:comment_leader,'\/')<CR>//e<CR>:nohlsearch<CR>
```
然后注释的快捷键是`,cc`，取消注释是`,cu`。

3. 插件法
常用插件有NerdCommenter，在`vimrc`的插件位置中加入`Plugin 'scrooloose/nerdcommenter'`，重新打开vim后输入`:PluginInstall`后安装成功。
注释的快捷键是`\cc`，反注释是`\cu`。其实和自己直接在vimrc中写没什么太大区别。
其它注释插件大同小异，就不都说了。





## Vim里Insert模式下不能按Backspace删除前面的内容
因为默认当前插入只能创建新内容，不允许改动别的东西。如果要变成Insert mode下随便编辑的模式，在`~/.vimrc`中加上：
```
set backspace=indent,eol,start
```
或者更简单的`set backspace=2`，效果一样。





# Vim中Tab变Space等相关设置
Tab和Space之争和Vim于Emacs是一样等，我是Vim和Space派。但是我和大多数人一样喜欢按Tab出Space。
在`~/.vimrc`中设置如下，重启vim就会生效：
```
set autoindent "换行时自动缩排 同时对应的还有其它两种模式 smartindent, cindent
set tabstop=4 "设定tab宽度为4个字符
set shiftwidth=4 "设定自动缩进为4个字符
set expandtab "用space替代tab的输入 取消的话 就用set noexpandtab "不用space替代tab的输入
retab "打开文件时自动转换所有tab为空格
```





# Vim快捷命令

- 上下行调换位置：`ddp`
- 前后字符调换位置：`xp`

### 删除命令
- 删至行尾：`d$`
- 删至行头：`d0`
- 此行以前所有行全部删除：`dgg`
- 此行以前所有行全部删除：`dG`
- 删除扩号之间内容：`di(` 注意，它非常只能，会识别到离自己最近的一组括号组
- 删除？号之间等内容：和引号之间一样，用`di`+符号，如单引号`di'`、双引号`di"`等。

### 删除、复制引号，括号中的内容
参考[这篇文章](http://blog.csdn.net/YHM07/article/details/44522315)。
下面的符号可以是`'   "  [  (  { `等，注意都是左半边。

以下的命令对标点内的内容操作
1. `ci`+符号：分别更改这些配对符号中的内容 
2. `di`+符号：分别删除这些配对符号中的内容 
3. `yi`+符号：分别复制这些配对符号中的内容 
4. `vi`+符号：分别选中这些配对符号中的内容 

如果把上面各条命令中的`i`改成`a`,可以连配对符号一起操作





# Vim Movement Commands

![image](https://user-images.githubusercontent.com/14041622/35904841-a4c7c586-0c1f-11e8-9ae0-374cb310541a.png)






# Vim产生的`.swp`文件
参考文章：[VIM不正常退出产生的swp文件](http://blog.csdn.net/pwiling/article/details/51830781)
常用关于swp文件的命令或`vimrc`配置：
- 查看当前目录下的所有swp文件: `vim -r`
- 恢复文件：`vim -r filename`，上次意外退出没有保存的修改，就会覆盖文件。
- 停止vim产生交换文件：在`~/.vimrc`中加入`set noswapfile`
- 定时自动保存文件：
```
set updatetime=23000 " 设置每200个字符保存一次
set updatecount=400 " 设置每4秒保存一次
" set updatecount=0 " 不保存交换文件
```
- 设置交换文件默认目录：`set directory=./tmp`





# Vim自动运行（或编译运行）文件
不像SublimeRepl需要安装插件，Vim原生支持直接运行python等代码。只要输入命令：
`:!python %`
其它语言代码类似。
输入命令后，vim界面会暂时跳出编辑页面跳到终端页面显示执行过程，期间可以按任意键返回vim编辑页面。
输过一次后，就可以用`:!!`直接重复上次的命令，不用再输一遍命令。
![screencast 2018-02-07 16-17-40](https://user-images.githubusercontent.com/14041622/35906002-00ab9e64-0c24-11e8-86c6-a72026149396.gif)






# Vim左下角总显示"recording"
这是因为不小心按到了`q`键，进入了录制宏模式。
再按以下`q`就退出了。





# Vim支持鼠标滚动界面
Mac下，Vim支持鼠标滚动光标，通过光标移动上下翻动页面。但是这样太别扭了，我们需要的是滚轮控制界面滚动，如vim中`ctrl+e`一样的效果。
简单：`~/.vimrc`中加一句`set mouse=a`即可。
不过这样设置会导致每次用鼠标选择一段文本都会自动进入visual模式，这样的话我们就没法复制到系统剪切板了。
网上说mouse后一个-好即可，如`set mouse-=a`，但是试过没用。
这时候，需要按住`Alt`键然后再用鼠标选择文本，这样一来就不会启动v模式，且可以复制到剪切板。





# Vim里批量替换文字
没有一般编辑器按快捷键那么方便，需要以输入一条命令的方式才能执行。
格式如下：
- 对当前行执行替换  `:s/查找内容/替换内容/g`
- 在全文执行替换  `:%s/查找内容/替换内容/g`
- 对选中行中内容进行批量替换  用v模式选中行然后`s/查找内容/替换内容/g`

大概可以看到，`s`代表执行search命令，`%`代表全文执行，`/`是相当于分隔符，`g`代表global对指定范围内所有结果进行替换，如果没有`g`那么只替换第一个找到的结果。





# Vim 的Git插件 - `Fugitive`
在vim里面操作，总是切换出去用git命令提交，一开始学习阶段还好，但是慢慢也烦了，就找到了这款最通用的插件，而且是Vundle管理器的默认搭配插件。
[参考文章](http://vimcasts.org/episodes/fugitive-vim---a-complement-to-command-line-git/)。
常用命令如下：
![image](https://user-images.githubusercontent.com/14041622/36022290-9060671a-0dc3-11e8-98c7-6b37f7160f34.png)






# Vim的NerdTree插件
> 一个项目文件多起来时，左边的文件树菜单是必要的。

![image](https://user-images.githubusercontent.com/14041622/36320392-068694a6-1381-11e8-8c3d-adcb3ad94478.png)

在vundle插件管理的方式，直接在`~/.vimrc`中的Plugin段落中加入`Plugin "scrooloose/nerdtree
"`然后重启Vim并输入`PluginInstall`，即可完成安装

然后输入`: NERDTreeToggle`即可打开文件树。当然，默认是关闭的，需要每次都输入命令打开。
还可以设置vim快捷键来映射,在vimrc中加入：
```
map <F3> :NERDTreeMirror<CR>
map <F3> :NERDTreeToggle<CR>
```

常用文件树快捷键：（[参考文章](https://yang3wei.github.io/blog/2013/01/29/nerdtree-kuai-jie-jian-ji-lu/)）
### 切换工作台和目录
```
ctrl + w + h    光标 focus 左侧树形目录
ctrl + w + l    光标 focus 右侧文件显示窗口
ctrl + w + w    光标自动在左右侧窗口切换
ctrl + w + r    移动当前窗口的布局位置

o       在已有窗口中打开文件、目录或书签，并跳到该窗口
go      在已有窗口 中打开文件、目录或书签，但不跳到该窗口
t       在新 Tab 中打开选中文件/书签，并跳到新 Tab
T       在新 Tab 中打开选中文件/书签，但不跳到新 Tab
i       split 一个新窗口打开选中文件，并跳到该窗口
gi      split 一个新窗口打开选中文件，但不跳到该窗口
s       vsplit 一个新窗口打开选中文件，并跳到该窗口
gs      vsplit 一个新 窗口打开选中文件，但不跳到该窗口
!       执行当前文件
O       递归打开选中 结点下的所有目录
```

### 切换标签页
```
:tabnew [++opt选项] ［＋cmd］ 文件      建立对指定文件新的tab
:tabc   关闭当前的 tab
:tabo   关闭所有其他的 tab
:tabs   查看所有打开的 tab
:tabp   前一个 tab
:tabn   后一个 tab

标准模式下：
gT      前一个 tab
gt      后一个 tab
```

### NerdTree 在 .vimrc 中的常用配置
```
" 在 vim 启动的时候默认开启 NERDTree（autocmd 可以缩写为 au）
autocmd VimEnter * NERDTree

" 按下 F2 调出/隐藏 NERDTree
map  :silent! NERDTreeToggle

" 将 NERDTree 的窗口设置在 vim 窗口的右侧（默认为左侧）
let NERDTreeWinPos="right"

" 当打开 NERDTree 窗口时，自动显示 Bookmarks
let NERDTreeShowBookmarks=1
```

## 存在问题
目前问题是，不能保存所有打开文件的状态。在同一个tab中打开另一个文件时，之前文件的编辑历史都会丢失，也就是没法`u`撤销编辑。即使有相关的方法控制这些，只是作为一个文件菜单来说，这也太麻烦了。
解决方案就是，文件都在新tab打开，这样就可以保持各自状态了。





### Text editors learning curves
![image](https://user-images.githubusercontent.com/14041622/36091285-3ec383bc-101e-11e8-82e6-4e1e785142fc.png)



